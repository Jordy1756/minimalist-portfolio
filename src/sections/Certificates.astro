---
import type { Certificate } from "@entities/certificate";
import Section from "@components/Section.astro";
import CertificateCard from "@components/CertificateCard.astro";
import { getLangFromUrl, useTranslations } from "@utils/i18n";

interface Props {
	certificates: Certificate[];
}

const { certificates } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const certificatesByYear = certificates.reduce(
	(acc, cert) => {
		const year = new Date(cert.date).getFullYear();
		(acc[year] = acc[year] || []).push(cert);
		return acc;
	},
	{} as Record<number, Certificate[]>
);

const sortedYears = Object.keys(certificatesByYear)
	.map(Number)
	.sort((a, b) => b - a);
---

<Section title={t("certificates.title")}>
	<div class="flex flex-col gap-8">
		{
			sortedYears.map((year) => (
				<div class="flex flex-col gap-1">
					<span class="font-bold text-neutral-900">{year}</span>
					<ul class="ml-6 flex flex-col gap-4 border-l border-neutral-200">
						{certificatesByYear[year].map((certificate) => (
							<li>
								<CertificateCard certificate={certificate} />
							</li>
						))}
					</ul>
				</div>
			))
		}
	</div>
</Section>
